{% extends "base.html" %}

{% block title %}{{ translated.name if translated else service_option.name }}{% endblock %}

{% block content %}
<section class="service-detail-page py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <!-- Service Header -->
                <div class="service-header text-center mb-5">
                    <div class="service-icon-wrapper mb-4">
                        {% if 'AI' in service_option.name or '분석' in service_option.name %}
                        <i class="bi bi-cpu-fill"></i>
                        {% elif '컬러' in service_option.name or '레슨' in service_option.name or '컨설팅' in service_option.name %}
                        <i class="bi bi-palette-fill"></i>
                        {% elif '메이크업' in service_option.name or '헤어' in service_option.name or '패션' in service_option.name %}
                        <i class="bi bi-magic"></i>
                        {% else %}
                        <i class="bi bi-camera-fill"></i>
                        {% endif %}
                    </div>
                    <h1 class="service-title mb-3">{{ translated.name if translated else service_option.name }}</h1>
                    <p class="service-subtitle">{{ translated.detailed_description or translated.description if translated else (service_option.detailed_description or service_option.description) }}</p>
                </div>
                
                <!-- 상세 내용 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.details and service_option.details.strip() and details %}
                <div class="mb-5">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-list-check me-2"></i>{{ _('상세 내용') }}</h2>
                        <ul class="feature-list">
                            {% for detail in details %}
                            <li class="feature-item">
                                <i class="bi bi-check-circle-fill"></i>
                                <span>{{ detail }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}
                
                <!-- 패키지 및 가격 정보 (다중 테이블 지원) - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.packages and service_option.packages.strip() and packages %}
                <div class="mb-5">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-tag me-2"></i>{{ _('패키지 및 가격') }}</h2>
                        
                        {% if packages.tables is defined %}
                            {# 새로운 다중 테이블 형식 #}
                            {% for table in packages.tables %}
                                {% if table.packages and table.packages|length > 0 %}
                                <div class="package-table-section{% if not loop.first %} mt-4{% endif %}">
                                    {% if table.title %}
                                    <h3 class="package-table-title">{{ table.title }}</h3>
                                    {% endif %}
                                    <div class="package-table-container">
                                        <table class="stg_table">
                                            <thead>
                                                <tr>
                                                    <th>{{ _('패키지명') }}</th>
                                                    <th>{{ _('서비스 내용') }}</th>
                                                    <th>{{ _('소요시간') }}</th>
                                                    <th>{{ _('가격') }}</th>
                                                    <th>{{ _('비고') }}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for package in table.packages %}
                                                <tr>
                                                    <td class="stg_table_name">{{ package.name }}</td>
                                                    <td class="stg_table_desc">{{ package.description }}</td>
                                                    <td class="stg_table_duration">{{ package.duration }}</td>
                                                    <td class="stg_table_price">{% if current_lang == 'ko' %}{{ package.price|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ package.price }}{% endif %}</td>
                                                    <td class="stg_table_notes">{{ package.notes if package.notes else '' }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            {# 기존 단일 배열 형식 (하위 호환성) #}
                            <div class="package-table-container">
                                <table class="stg_table">
                                    <thead>
                                        <tr>
                                            <th>{{ _('패키지명') }}</th>
                                            <th>{{ _('서비스 내용') }}</th>
                                            <th>{{ _('소요시간') }}</th>
                                            <th>{{ _('가격') }}</th>
                                            <th>{{ _('비고') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for package in packages %}
                                        <tr>
                                            <td class="stg_table_name">{{ package.name }}</td>
                                            <td class="stg_table_desc">{{ package.description }}</td>
                                            <td class="stg_table_duration">{{ package.duration }}</td>
                                            <td class="stg_table_price">{% if current_lang == 'ko' %}{{ package.price|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ package.price }}{% endif %}</td>
                                            <td class="stg_table_notes">{{ package.notes if package.notes else '' }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- 예약 방법 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.booking_method and service_option.booking_method.strip() %}
                {% set booking_method_text = translated.booking_method if translated and translated.booking_method else service_option.booking_method %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-calendar-check me-2"></i>{{ _('예약 방법') }}</h2>
                        <div class="booking-content">
                            {% set booking_lines = booking_method_text.split('\n') %}
                            {% set ns = namespace(in_example=false, in_account=false, has_normal=false) %}
                            
                            {% for line in booking_lines %}
                                {% if line.strip() %}
                                    {% set trimmed = line.strip()|replace('\u200b', '')|replace('\u200c', '')|replace('\u200d', '')|replace('\ufeff', '') %}
                                    {% set is_example = trimmed.startswith('예)') or trimmed.startswith('예 )') %}
                                    {% set is_account = trimmed.startswith('입금 계좌') or trimmed.startswith('입금계좌') %}
                                    {% set is_card_note = '*카드 결제' in trimmed or '*카드결제' in trimmed %}
                                    
                                    {# 예시 라인 처리 #}
                                    {% if is_example %}
                                        {% if ns.has_normal and not ns.in_example %}
                                            </ul>
                                            {% set ns.has_normal = false %}
                                        {% endif %}
                                        {% if not ns.in_example %}
                                            <div class="example-info">
                                            {% set ns.in_example = true %}
                                        {% endif %}
                                        <p class="example-line">{{ trimmed }}</p>
                                    
                                    {# 입금계좌 라인 처리 #}
                                    {% elif is_account or is_card_note %}
                                        {% if ns.has_normal %}
                                            </ul>
                                            {% set ns.has_normal = false %}
                                        {% endif %}
                                        {% if ns.in_example %}
                                            </div>
                                            {% set ns.in_example = false %}
                                        {% endif %}
                                        {% if not ns.in_account %}
                                            <div class="account-info">
                                            {% set ns.in_account = true %}
                                        {% endif %}
                                        {% if is_card_note %}
                                            <span class="note-text">{{ trimmed }}</span>
                                        {% else %}
                                            <strong>{{ trimmed }}</strong><br>
                                        {% endif %}
                                    
                                    {# 일반 라인 처리 #}
                                    {% else %}
                                        {% if ns.in_example %}
                                            </div>
                                            {% set ns.in_example = false %}
                                        {% endif %}
                                        {% if ns.in_account %}
                                            </div>
                                            {% set ns.in_account = false %}
                                        {% endif %}
                                        {% if not ns.has_normal %}
                                            <ul class="booking-list">
                                            {% set ns.has_normal = true %}
                                        {% endif %}
                                        <li>{{ trimmed }}</li>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            
                            {# 마지막 열린 태그 닫기 #}
                            {% if ns.has_normal %}</ul>{% endif %}
                            {% if ns.in_example %}</div>{% endif %}
                            {% if ns.in_account %}</div>{% endif %}
                            
                            <div class="text-center mt-4">
                                <a href="{{ url_for('main.booking_choice') }}" class="stg_button">
                                    <span class="stg_button_text">{{ _('문의/예약 신청') }}</span>
                                    <i class="bi bi-arrow-right stg_button_arrow"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 제작비 결제 방식 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.payment_info and service_option.payment_info.strip() %}
                {% set payment_info_text = translated.payment_info if translated and translated.payment_info else service_option.payment_info %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-credit-card me-2"></i>{{ _('제작비 결제 방식') }}</h2>
                        <div class="booking-content">
                            <ul class="booking-list">
                                {% for line in payment_info_text.split('\n') %}
                                {% if line.strip() %}
                                <li>{{ line.strip() }}</li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                            <div class="account-info">
                                <strong>{{ _('입금 계좌') }} : 국민 46480101210393 이지은 ((신)스타일그래퍼)</strong><br>
                                <span class="note-text">{{ _('*카드 결제는 스타일그래퍼 샵으로 직접 방문하시면 가능합니다.') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 안내 사항 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.guide_info and service_option.guide_info.strip() %}
                {% set guide_info_text = translated.guide_info if translated and translated.guide_info else service_option.guide_info %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-info-circle me-2"></i>{{ _('안내 사항') }}</h2>
                        <div class="booking-content">
                            {% for line in guide_info_text.split('\n') %}
                            {% if line.strip() %}
                            <p class="guide-paragraph">{{ line.strip() }}</p>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 예약 변경 및 환불 규정 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% set has_refund_text_original = service_option.refund_policy_text and service_option.refund_policy_text.strip() %}
                {% set has_refund_table_original = service_option.refund_policy_table and service_option.refund_policy_table.strip() %}
                {% if has_refund_text_original or has_refund_table_original %}
                {% set refund_policy_text_val = translated.refund_policy_text if translated and translated.refund_policy_text else service_option.refund_policy_text %}
                {% set refund_policy_table_val = translated.refund_policy_table if translated and translated.refund_policy_table else service_option.refund_policy_table %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-arrow-repeat me-2"></i>{{ _('예약 변경 및 환불 규정') }}</h2>
                        <div class="booking-content">
                            {% if refund_policy_text_val and refund_policy_text_val.strip() %}
                            <ul class="booking-list">
                                {% for line in refund_policy_text_val.split('\n') %}
                                {% if line.strip() %}
                                <li>{{ line.strip() }}</li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                            {% endif %}
                            
                            {% if refund_policy_table_val and refund_policy_table_val.strip() %}
                                {% set refund_rules = refund_policy_table_val.split('\n') %}
                                {% if refund_rules %}
                                <h4 class="refund-subtitle">{{ _('환불 기준표') }}</h4>
                            <div class="refund-table-container">
                                <table class="stg_table">
                                    <thead>
                                        <tr>
                                            <th>{{ _('기준일') }}</th>
                                            <th>{{ _('환불비율') }}</th>
                                            <th>{{ _('비고') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rule in refund_rules %}
                                        {% if rule.strip() and '|' in rule %}
                                        {% set parts = rule.split('|') %}
                                        <tr>
                                            <td class="stg_table_name">{{ parts[0].strip() }}</td>
                                            <td>{{ parts[1].strip() }}</td>
                                            <td class="stg_table_notes">{{ parts[2].strip() if parts|length > 2 else '' }}</td>
                                        </tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 시간외 업차지 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.overtime_charge_table and service_option.overtime_charge_table.strip() %}
                {% set overtime_table_val = translated.overtime_charge_table if translated and translated.overtime_charge_table else service_option.overtime_charge_table %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-clock-history me-2"></i>{{ _('시간외 업차지') }}</h2>
                        <div class="booking-content">
                            <div class="overtime-charge-table-container">
                                {% set overtime_charge_rules = overtime_table_val.split('\n') %}
                                {% if overtime_charge_rules %}
                                <table class="stg_table">
                                    <thead>
                                        <tr>
                                            <th>{{ _('시간대/조건') }}</th>
                                            <th>{{ _('추가 요금') }}</th>
                                            <th>{{ _('비고') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rule in overtime_charge_rules %}
                                        {% if rule.strip() and '|' in rule %}
                                        {% set parts = rule.split('|') %}
                                        <tr>
                                            <td class="stg_table_name">{{ parts[0].strip() }}</td>
                                            <td class="stg_table_price">{% if current_lang == 'ko' %}{{ parts[1].strip()|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ parts[1].strip() }}{% endif %}</td>
                                            <td class="stg_table_notes">{{ parts[2].strip() if parts|length > 2 else '' }}</td>
                                        </tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Contact Section -->
                <div class="stg_kakao_format mt-5">
                    <div class="stg_kakao_content">
                        <p class="stg_body_text stg_kakao_text mb-4">{{ _('궁금하신 점이나 예약신청은 아래 버튼을 클릭해주세요') }}</p>
                        <a href="https://www.stylegrapher.com/booking-choice" class="stg_button">
                            <span class="stg_button_text">{{ _('문의/예약 신청') }}</span>
                            <i class="bi bi-arrow-right stg_button_arrow"></i>
                        </a>
                    </div>
                    <div class="stg_kakao_glow"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.service-detail-page {
    min-height: 100vh;
}

/* Service Header */
.service-header {
    background: rgba(18, 0, 36, 0.6);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(181, 126, 220, 0.2);
    border-radius: 28px;
    padding: 4rem 2rem;
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
    position: relative;
    overflow: hidden;
}

.service-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--neon-lavender), var(--electric-violet), transparent);
    box-shadow: 0 0 25px rgba(181, 126, 220, 0.7);
}

.service-icon-wrapper {
    font-size: 4rem;
    color: var(--neon-lavender);
    filter: drop-shadow(0 0 25px rgba(181, 126, 220, 0.6));
}

.service-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.8rem;
    color: var(--neon-lavender);
    font-weight: 400;
    text-shadow: 0 0 40px rgba(181, 126, 220, 0.5);
    letter-spacing: 0.05em;
}

.service-subtitle {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.8;
    margin: 0;
    white-space: pre-line;
}

/* Service Info Card - stg_card_format 확장 (좌측 정렬 컨텐츠용) */
.service-info-card {
    text-align: left !important;
    padding: 2rem !important;
    display: block !important;
}

.service-info-card:hover {
    transform: translateY(-3px);
}

/* Light Mode 스타일 */
body.light-mode .service-info-card {
    text-align: left !important;
}

.section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem;
    color: var(--neon-lavender);
    font-weight: 400;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(181, 126, 220, 0.2);
    position: relative;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, var(--neon-lavender), transparent);
    box-shadow: 0 0 10px rgba(181, 126, 220, 0.5);
}

/* Feature List */
.feature-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.feature-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1rem;
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.7;
}

.feature-item i {
    color: var(--neon-lavender);
    margin-right: 0.75rem;
    margin-top: 0.2rem;
    flex-shrink: 0;
    filter: drop-shadow(0 0 5px rgba(181, 126, 220, 0.5));
}

/* Package Table Section */
.package-table-section {
    border-top: 1px solid rgba(181, 126, 220, 0.15);
    padding-top: 1.5rem;
}

.package-table-section:first-child {
    border-top: none;
    padding-top: 0;
}

.package-table-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.3rem;
    color: var(--neon-lavender);
    font-weight: 500;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px dashed rgba(181, 126, 220, 0.3);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.package-table-title::before {
    content: '▸';
    color: rgba(181, 126, 220, 0.7);
}

.package-table-container {
    overflow-x: auto;
}

/* Booking Content */
.booking-content {
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.8;
}

.booking-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.booking-list li {
    position: relative;
    padding-left: 1.5rem;
    margin-bottom: 1rem;
    line-height: 1.7;
}

.booking-list li::before {
    content: "•";
    color: var(--neon-lavender);
    font-weight: bold;
    position: absolute;
    left: 0;
    top: 0;
    text-shadow: 0 0 10px rgba(181, 126, 220, 0.5);
}

.guide-paragraph {
    margin-bottom: 1rem;
    color: rgba(255, 255, 255, 0.75);
}

.note-text {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
}

/* Light Mode - Note Text */
body.light-mode .note-text {
    color: rgba(90, 70, 110, 0.7);
}

.account-info {
    background: rgba(181, 126, 220, 0.1);
    border-left: 3px solid var(--neon-lavender);
    padding: 1rem 1.5rem;
    margin-top: 0.75rem;
    border-radius: 0 12px 12px 0;
    box-shadow: 0 0 20px rgba(181, 126, 220, 0.1);
}

.account-info strong {
    color: var(--neon-lavender);
}

/* Example Info Box (예) 부분) */
.example-info {
    background: rgba(181, 126, 220, 0.08);
    border-left: 3px solid rgba(181, 126, 220, 0.6);
    padding: 1rem 1.5rem;
    margin-top: 0.75rem;
    border-radius: 0 12px 12px 0;
    box-shadow: 0 0 15px rgba(181, 126, 220, 0.08);
}

.example-line {
    color: rgba(255, 255, 255, 0.75);
    margin-bottom: 0.5rem;
    line-height: 1.7;
}

.example-line:last-child {
    margin-bottom: 0;
}

/* Light Mode - Example Info */
body.light-mode .example-info {
    background: rgba(139, 92, 246, 0.08);
    border-left-color: rgba(139, 92, 246, 0.6);
    box-shadow: 0 0 15px rgba(139, 92, 246, 0.08);
}

body.light-mode .example-line {
    color: var(--stg-body-color-light);
}

/* Light Mode - Account Info */
body.light-mode .account-info {
    background: rgba(139, 92, 246, 0.1);
    border-left-color: rgba(139, 92, 246, 0.7);
    box-shadow: 0 0 20px rgba(139, 92, 246, 0.1);
}

body.light-mode .account-info strong {
    color: #6B4D8A;
}

/* Refund & Overtime Table Containers */
.refund-table-container,
.overtime-charge-table-container {
    margin-top: 1.5rem;
}

.refund-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.2rem;
    color: var(--neon-lavender);
    font-weight: 400;
    margin: 1.5rem 0 1rem 0;
}

/* Responsive */
@media (max-width: 768px) {
    .service-header {
        padding: 3rem 1.5rem;
    }
    
    .service-title {
        font-size: 2rem;
    }
    
    .service-icon-wrapper {
        font-size: 3rem;
    }
    
    .service-info-card {
        padding: 1.5rem !important;
    }
    
    .section-title {
        font-size: 1.4rem;
    }
}
</style>
{% endblock %}
