{% extends "base.html" %}

{% block title %}{{ translated.name if translated else service_option.name }}{% endblock %}

{% block content %}
<section class="service-detail-page py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <!-- Service Header -->
                <div class="service-header stg_card_sub_format text-center mb-5">
                    <h1 class="stg_page_title mb-3">{{ translated.name if translated else service_option.name }}</h1>
                    <p class="service-subtitle">{{ translated.detailed_description or translated.description if translated else (service_option.detailed_description or service_option.description) }}</p>
                </div>
                
                <!-- 패키지 화보 갤러리 (대표 이미지 + 모달 갤러리) -->
                {% if photos_by_category %}
                <div class="package-photo-gallery mb-5">
                    {% for category, photos in photos_by_category.items() %}
                    <div class="package-photo-category mb-4">
                        <h3 class="category-title stg_card_title">
                            <i class="bi bi-camera me-2"></i>{{ translate_category(category, current_lang) if translate_category else category }}
                        </h3>
                        
                        {# 해당 카테고리의 패키지 정보 찾기 (원본 한국어 데이터로 매칭 후 번역본 사용) #}
                        {% set ns = namespace(category_packages=[], matched_index=-1) %}
                        {# 원본 한국어 packages에서 매칭되는 인덱스 찾기 #}
                        {% if original_packages and original_packages.tables is defined %}
                            {% for table in original_packages.tables %}
                                {# 정확한 매칭 #}
                                {% if table.title == category %}
                                    {% set ns.matched_index = loop.index0 %}
                                {# 환생 키워드 매칭 #}
                                {% elif '환생' in category and '환생' in table.title %}
                                    {% set ns.matched_index = loop.index0 %}
                                {# 린 키워드 매칭 (린님 화보 <-> 린's Pick 화보) #}
                                {% elif '린' in category and '린' in table.title %}
                                    {% set ns.matched_index = loop.index0 %}
                                {# 부분 문자열 매칭 #}
                                {% elif category in table.title or table.title in category %}
                                    {% set ns.matched_index = loop.index0 %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        {# 매칭된 인덱스로 번역된 packages에서 패키지 정보 가져오기 #}
                        {% if ns.matched_index >= 0 and packages and packages.tables is defined and ns.matched_index < packages.tables|length %}
                            {% set ns.category_packages = packages.tables[ns.matched_index].packages %}
                        {% endif %}
                        
                        <div class="row g-4">
                            {% for photo in photos %}
                            <div class="col-md-6 col-lg-4">
                                <div class="package-photo-card" 
                                     data-photo-id="{{ photo.id }}"
                                     data-concept="{{ translate_concept(photo.concept, current_lang) if translate_concept else photo.concept }}"
                                     data-category="{{ translate_category(category, current_lang) if translate_category else category }}"
                                     data-images='{{ photo.images | tojson }}'>
                                    <h4 class="concept-title">{{ translate_concept(photo.concept, current_lang) if translate_concept else photo.concept }}</h4>
                                    {% if photo.images %}
                                    {# 대표 이미지 1장만 표시 #}
                                    <div class="package-photo-thumbnail" 
                                         data-bs-toggle="modal" 
                                         data-bs-target="#packagePhotoModal"
                                         data-photo-id="{{ photo.id }}">
                                        <img src="{{ url_for('main.serve_package_photo_image', image_id=photo.images[0]) }}" 
                                             class="d-block w-100 package-thumbnail-img" 
                                             alt="{{ translate_concept(photo.concept, current_lang) if translate_concept else photo.concept }}"
                                             loading="lazy">
                                        <div class="package-photo-overlay">
                                            <div class="overlay-content">
                                                <i class="bi bi-eye-fill"></i>
                                                <p>{{ _('모든 사진 보기') }}</p>
                                            </div>
                                        </div>
                                        <div class="photo-count-badge">
                                            <i class="bi bi-images me-1"></i>{{ photo.images|length }}{{ _('장') }}
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {# 패키지 정보 표시 #}
                                    <div class="package-info-section">
                                        {% if ns.category_packages and ns.category_packages|length > 0 %}
                                            {# 모든 패키지 정보 표시 #}
                                            {% for pkg in ns.category_packages %}
                                            <div class="package-info-block{% if not loop.first %} package-info-divider{% endif %}">
                                                <div class="package-info-item">
                                                    <span class="info-label">{{ _('패키지') }}</span>
                                                    <span class="info-value">{{ pkg.name }}</span>
                                                </div>
                                                <div class="package-info-item">
                                                    <span class="info-value">{{ pkg.description }}</span>
                                                </div>
                                                <div class="package-info-item">
                                                    <span class="info-value">{{ pkg.duration }} {{ _('소요') }}</span>
                                                </div>
                                                <div class="package-info-item package-price">
                                                    <span class="info-value">{% if current_lang == 'ko' %}{{ pkg.price|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ pkg.price }}{% endif %}</span>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- 패키지 화보 모달 -->
                <div class="modal fade" id="packagePhotoModal" tabindex="-1" aria-labelledby="packagePhotoModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content package-modal-content">
                            <div class="modal-header package-modal-header">
                                <h5 class="modal-title" id="packagePhotoModalLabel"></h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-0">
                                <div class="package-gallery-grid" id="packageGalleryGrid">
                                    <!-- 이미지들이 JavaScript로 동적 로드됨 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 이미지 상세 보기 모달 (Carousel) -->
                <div class="modal fade" id="packageImageDetailModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content package-detail-modal-content">
                            <div class="modal-header package-modal-header">
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-0 text-center">
                                <img id="packageDetailImage" src="" class="img-fluid package-detail-img" alt="">
                                <div class="package-modal-navigation">
                                    <button type="button" id="packagePrevImage" class="btn package-modal-nav-btn">
                                        <i class="bi bi-chevron-left"></i>
                                    </button>
                                    <button type="button" id="packageNextImage" class="btn package-modal-nav-btn">
                                        <i class="bi bi-chevron-right"></i>
                                    </button>
                                </div>
                                <div class="package-modal-caption mt-3">
                                    <p id="packageModalCaption" class="mb-1"></p>
                                    <small id="packageModalCounter"></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 상세 내용 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.details and service_option.details.strip() and details %}
                <div class="mb-5">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-list-check me-2"></i>{{ _('상세 내용') }}</h2>
                        <ul class="feature-list">
                            {% for detail in details %}
                            <li class="feature-item">
                                <i class="bi bi-check-circle-fill"></i>
                                <span class="stg_body_text">{{ detail }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}
                
                <!-- 패키지 및 가격 정보 (다중 테이블 지원) - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.packages and service_option.packages.strip() and packages %}
                <div class="mb-5">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-tag me-2"></i>{{ _('패키지 및 가격') }}</h2>
                        
                        {% if packages.tables is defined %}
                            {# 새로운 다중 테이블 형식 #}
                            {% for table in packages.tables %}
                                {% if table.packages and table.packages|length > 0 %}
                                <div class="package-table-section{% if not loop.first %} mt-4{% endif %}">
                                    {% if table.title %}
                                    <h3 class="package-table-title">{{ table.title }}</h3>
                                    {% endif %}
                                    {# Desktop: 테이블 형식 #}
                                    <div class="package-table-container package-desktop-view">
                                        <table class="stg_table">
                                            <thead>
                                                <tr>
                                                    <th>{{ _('패키지명') }}</th>
                                                    <th>{{ _('서비스 내용') }}</th>
                                                    <th>{{ _('소요시간') }}</th>
                                                    <th>{{ _('가격') }}</th>
                                                    <th>{{ _('비고') }}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for package in table.packages %}
                                                <tr>
                                                    <td class="stg_table_name">{{ package.name }}</td>
                                                    <td class="stg_table_desc">{{ package.description }}</td>
                                                    <td class="stg_table_duration">{{ package.duration }}</td>
                                                    <td class="stg_table_price">{% if current_lang == 'ko' %}{{ package.price|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ package.price }}{% endif %}</td>
                                                    <td class="stg_table_notes">{{ package.notes if package.notes else '' }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {# Mobile: 카드 형식 #}
                                    <div class="package-mobile-view">
                                        {% for package in table.packages %}
                                        <div class="package-mobile-card">
                                            <h4 class="package-mobile-card-title">{{ package.name }}</h4>
                                            <ul class="package-mobile-card-list">
                                                <li>{{ package.description }}</li>
                                                <li>{{ package.duration }} {{ _('소요') }}</li>
                                                <li>{% if current_lang == 'ko' %}{{ package.price|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ package.price }}{% endif %}</li>
                                                {% if package.notes and package.notes.strip() %}
                                                <li>{{ package.notes }}</li>
                                                {% endif %}
                                            </ul>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            {# 기존 단일 배열 형식 (하위 호환성) #}
                            {# Desktop: 테이블 형식 #}
                            <div class="package-table-container package-desktop-view">
                                <table class="stg_table">
                                    <thead>
                                        <tr>
                                            <th>{{ _('패키지명') }}</th>
                                            <th>{{ _('서비스 내용') }}</th>
                                            <th>{{ _('소요시간') }}</th>
                                            <th>{{ _('가격') }}</th>
                                            <th>{{ _('비고') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for package in packages %}
                                        <tr>
                                            <td class="stg_table_name">{{ package.name }}</td>
                                            <td class="stg_table_desc">{{ package.description }}</td>
                                            <td class="stg_table_duration">{{ package.duration }}</td>
                                            <td class="stg_table_price">{% if current_lang == 'ko' %}{{ package.price|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ package.price }}{% endif %}</td>
                                            <td class="stg_table_notes">{{ package.notes if package.notes else '' }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {# Mobile: 카드 형식 #}
                            <div class="package-mobile-view">
                                {% for package in packages %}
                                <div class="package-mobile-card">
                                    <h4 class="package-mobile-card-title">{{ package.name }}</h4>
                                    <ul class="package-mobile-card-list">
                                        <li>{{ package.description }}</li>
                                        <li>{{ package.duration }} {{ _('소요') }}</li>
                                        <li>{% if current_lang == 'ko' %}{{ package.price|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ package.price }}{% endif %}</li>
                                        {% if package.notes and package.notes.strip() %}
                                        <li>{{ package.notes }}</li>
                                        {% endif %}
                                    </ul>
                                </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- 예약 방법 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.booking_method and service_option.booking_method.strip() %}
                {% set booking_method_text = translated.booking_method if translated and translated.booking_method else service_option.booking_method %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-calendar-check me-2"></i>{{ _('예약 방법') }}</h2>
                        
                        <div class="booking-content">
                            {% set booking_lines = booking_method_text.split('\n') %}
                            {% set ns = namespace(in_example=false, in_account=false, has_normal=false) %}
                            
                            {% for line in booking_lines %}
                                {% if line.strip() %}
                                    {% set trimmed = line.strip()|replace('\u200b', '')|replace('\u200c', '')|replace('\u200d', '')|replace('\ufeff', '') %}
                                    {% set is_example = trimmed.startswith('예)') or trimmed.startswith('예 )') or trimmed.startswith('Example)') or trimmed.startswith('Example )') or trimmed.startswith('Ex)') or trimmed.startswith('例）') or trimmed.startswith('例)') or trimmed.startswith('例：') or trimmed.startswith('例如）') or trimmed.startswith('例如)') %}
                                    {% set is_account = trimmed.startswith('입금 계좌') or trimmed.startswith('입금계좌') or trimmed.startswith('Deposit Account') or trimmed.startswith('Bank Account') or trimmed.startswith('振込口座') or trimmed.startswith('入金口座') or trimmed.startswith('汇款账户') or trimmed.startswith('存款账户') %}
                                    {% set is_card_note = '*카드 결제' in trimmed or '*카드결제' in trimmed or '*Card payment' in trimmed or '*card payment' in trimmed or '*カード決済' in trimmed or '*クレジットカード' in trimmed or '*刷卡' in trimmed or '*信用卡' in trimmed %}
                                    
                                    {# 예시 라인 처리 #}
                                    {% if is_example %}
                                        {% if ns.has_normal and not ns.in_example %}
                                            </ul>
                                            {% set ns.has_normal = false %}
                                        {% endif %}
                                        {% if not ns.in_example %}
                                            <div class="example-info">
                                            {% set ns.in_example = true %}
                                        {% endif %}
                                        <p class="example-line stg_body_text">{{ trimmed }}</p>
                                    
                                    {# 입금계좌 라인 처리 #}
                                    {% elif is_account or is_card_note %}
                                        {% if ns.has_normal %}
                                            </ul>
                                            {% set ns.has_normal = false %}
                                        {% endif %}
                                        {% if ns.in_example %}
                                            </div>
                                            {% set ns.in_example = false %}
                                        {% endif %}
                                        {% if not ns.in_account %}
                                            <div class="account-info">
                                            {% set ns.in_account = true %}
                                        {% endif %}
                                        {% if is_card_note %}
                                            <span class="note-text stg_body_text">{{ trimmed }}</span>
                                        {% else %}
                                            <strong class="stg_body_text">{{ trimmed }}</strong><br>
                                        {% endif %}
                                    
                                    {# 일반 라인 처리 #}
                                    {% else %}
                                        {% if ns.in_example %}
                                            </div>
                                            {% set ns.in_example = false %}
                                        {% endif %}
                                        {% if ns.in_account %}
                                            </div>
                                            {% set ns.in_account = false %}
                                        {% endif %}
                                        {% if not ns.has_normal %}
                                            <ul class="booking-list">
                                            {% set ns.has_normal = true %}
                                        {% endif %}
                                        <li class="stg_body_text">{{ trimmed }}</li>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            
                            {# 마지막 열린 태그 닫기 #}
                            {% if ns.has_normal %}</ul>{% endif %}
                            {% if ns.in_example %}</div>{% endif %}
                            {% if ns.in_account %}</div>{% endif %}
                            
                            <div class="text-center mt-4">
                                <a href="https://pf.kakao.com/_xgDcFK" target="_blank" class="stg_button">
                                    <span class="stg_button_text">{{ _('문의/예약 신청') }}</span>
                                    <i class="bi bi-arrow-right stg_button_arrow"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 제작비 결제 방식 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.payment_info and service_option.payment_info.strip() %}
                {% set payment_info_text = translated.payment_info if translated and translated.payment_info else service_option.payment_info %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-credit-card me-2"></i>{{ _('결제 방식') }}</h2>
                        <div class="booking-content">
                            <ul class="booking-list">
                                {% for line in payment_info_text.split('\n') %}
                                {% if line.strip() %}
                                <li class="stg_body_text">{{ line.strip() }}</li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                            <div class="account-info">
                                <strong class="stg_body_text">{{ _('입금 계좌') }} : 국민 46480101210393 이지은 ((신)스타일그래퍼)</strong><br>
                                <span class="note-text stg_body_text">{{ _('*카드 결제는 스타일그래퍼 샵으로 직접 방문하시면 가능합니다.') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 안내 사항 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.guide_info and service_option.guide_info.strip() %}
                {% set guide_info_text = translated.guide_info if translated and translated.guide_info else service_option.guide_info %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-info-circle me-2"></i>{{ _('안내 사항') }}</h2>
                        <div class="booking-content">
                            <ul class="booking-list">
                                {% for line in guide_info_text.split('\n') %}
                                {% if line.strip() %}
                                <li class="stg_body_text">{{ line.strip() }}</li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 예약 변경 및 환불 규정 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% set has_refund_text_original = service_option.refund_policy_text and service_option.refund_policy_text.strip() %}
                {% set has_refund_table_original = service_option.refund_policy_table and service_option.refund_policy_table.strip() %}
                {% if has_refund_text_original or has_refund_table_original %}
                {% set refund_policy_text_val = translated.refund_policy_text if translated and translated.refund_policy_text else service_option.refund_policy_text %}
                {% set refund_policy_table_val = translated.refund_policy_table if translated and translated.refund_policy_table else service_option.refund_policy_table %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-arrow-repeat me-2"></i>{{ _('예약 변경 및 환불 규정') }}</h2>
                        <div class="booking-content">
                            {% if refund_policy_text_val and refund_policy_text_val.strip() %}
                            <ul class="booking-list">
                                {% for line in refund_policy_text_val.split('\n') %}
                                {% if line.strip() %}
                                <li class="stg_body_text">{{ line.strip() }}</li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                            {% endif %}
                            
                            {% if refund_policy_table_val and refund_policy_table_val.strip() %}
                                {% set refund_rules = refund_policy_table_val.split('\n') %}
                                {% if refund_rules %}
                                <h4 class="refund-subtitle">{{ _('환불 기준표') }}</h4>
                            <div class="refund-table-container">
                                <table class="stg_table">
                                    <thead>
                                        <tr>
                                            <th>{{ _('기준일') }}</th>
                                            <th>{{ _('환불비율') }}</th>
                                            <th>{{ _('비고') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rule in refund_rules %}
                                        {% if rule.strip() and '|' in rule %}
                                        {% set parts = rule.split('|') %}
                                        <tr>
                                            <td class="stg_table_name">{{ parts[0].strip() }}</td>
                                            <td>{{ parts[1].strip() }}</td>
                                            <td class="stg_table_notes">{{ parts[2].strip() if parts|length > 2 else '' }}</td>
                                        </tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- 시간외 업차지 카드 - 원본이 비어있으면 표시하지 않음 -->
                {% if service_option.overtime_charge_table and service_option.overtime_charge_table.strip() %}
                {% set overtime_table_val = translated.overtime_charge_table if translated and translated.overtime_charge_table else service_option.overtime_charge_table %}
                <div class="mb-4">
                    <div class="stg_card_format service-info-card">
                        <h2 class="section-title"><i class="bi bi-clock-history me-2"></i>{{ _('시간외 업차지') }}</h2>
                        <div class="booking-content">
                            <div class="overtime-charge-table-container">
                                {% set overtime_charge_rules = overtime_table_val.split('\n') %}
                                {% if overtime_charge_rules %}
                                <table class="stg_table">
                                    <thead>
                                        <tr>
                                            <th>{{ _('시간대/조건') }}</th>
                                            <th>{{ _('추가 요금') }}</th>
                                            <th>{{ _('비고') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rule in overtime_charge_rules %}
                                        {% if rule.strip() and '|' in rule %}
                                        {% set parts = rule.split('|') %}
                                        <tr>
                                            <td class="stg_table_name">{{ parts[0].strip() }}</td>
                                            <td class="stg_table_price">{% if current_lang == 'ko' %}{{ parts[1].strip()|replace(' KRW', '원')|replace('KRW', '원') }}{% else %}{{ parts[1].strip() }}{% endif %}</td>
                                            <td class="stg_table_notes">{{ parts[2].strip() if parts|length > 2 else '' }}</td>
                                        </tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Contact Section -->
                <div class="stg_kakao_format mt-5">
                    <div class="stg_kakao_content">
                        <p class="stg_body_text stg_kakao_text mb-4">{{ _('궁금하신 점이나 예약신청은 아래 버튼을 클릭해주세요') }}</p>
                        <a href="https://pf.kakao.com/_xgDcFK" target="_blank" class="stg_button">
                            <span class="stg_button_text">{{ _('문의/예약 신청') }}</span>
                            <i class="bi bi-arrow-right stg_button_arrow"></i>
                        </a>
                    </div>
                    <div class="stg_kakao_glow"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.service-detail-page {
    min-height: 100vh;
}

/* 패키지 화보 갤러리 */
.package-photo-gallery {
    margin-top: 2rem;
}

.package-photo-category {
    margin-bottom: 2rem;
}

.category-title.stg_card_title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem !important;
    color: rgb(139, 92, 246) !important;
    font-weight: 500;
    margin-bottom: 1.5rem;
    padding: 0.75rem 1rem !important;
    background: #ffffff !important;
    border-radius: 8px;
    border: 1px solid rgba(139, 92, 246, 0.2) !important;
    display: flex;
    align-items: center;
}

.category-title.stg_card_title i {
    color: rgb(139, 92, 246) !important;
}

.package-photo-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(139, 95, 191, 0.1);
    border: 1px solid rgba(181, 126, 220, 0.2);
    transition: all 0.3s ease;
}

.package-photo-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(139, 95, 191, 0.2);
    border-color: rgba(181, 126, 220, 0.4);
}

.concept-title {
    font-family: 'Nanum Gothic', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    color: #44237A;
    padding: 1rem 1rem 0.5rem 1rem;
    margin: 0;
    text-align: center;
}

/* 대표 이미지 썸네일 */
.package-photo-thumbnail {
    position: relative;
    cursor: pointer;
    overflow: hidden;
}

.package-thumbnail-img {
    width: 100%;
    height: 300px;
    object-fit: contain !important;
    background-color: #f8f8f8;
    transition: transform 0.4s ease;
}

.package-photo-thumbnail:hover .package-thumbnail-img {
    transform: scale(1.05);
}

.package-photo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(181, 126, 220, 0.85), rgba(138, 43, 226, 0.85));
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.package-photo-thumbnail:hover .package-photo-overlay {
    opacity: 1;
}

.overlay-content {
    text-align: center;
    color: white;
}

.overlay-content i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
}

.overlay-content p {
    margin: 0;
    font-size: 1rem;
    font-weight: 500;
}

.photo-count-badge {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.3rem 0.6rem;
    border-radius: 15px;
    font-size: 0.8rem;
    backdrop-filter: blur(5px);
}

/* 패키지 정보 섹션 */
.package-info-section {
    padding: 1rem;
    border-top: 1px solid rgba(181, 126, 220, 0.15);
    background: rgba(139, 92, 246, 0.03);
}

.package-info-block {
    padding: 0;
}

.package-info-divider {
    margin-top: 0.8rem;
    padding-top: 0.8rem;
    border-top: 1px dashed rgba(139, 92, 246, 0.3);
}

.package-info-item {
    display: flex;
    align-items: center;
    margin-bottom: 0.4rem;
    font-size: 0.9rem;
    color: #555;
}

.package-info-item:last-child {
    margin-bottom: 0;
}

.info-label {
    font-weight: 600;
    color: #8B5CF6;
    margin-right: 0.5rem;
    min-width: 50px;
}

.info-value {
    color: #444;
}

.package-price .info-value {
    font-weight: 700;
    color: #44237A;
    font-size: 1rem;
}

/* 패키지 화보 모달 스타일 */
.package-modal-content {
    background: rgba(18, 0, 36, 0.95);
    backdrop-filter: blur(30px);
    border: 1px solid rgba(181, 126, 220, 0.3);
    border-radius: 24px;
    box-shadow: 0 0 60px rgba(181, 126, 220, 0.3);
}

.package-modal-header {
    border: none;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.package-modal-header .modal-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    color: #F0E4FF;
    font-weight: 500;
}

.package-gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    padding: 1.5rem;
}

.package-gallery-item {
    position: relative;
    cursor: pointer;
    border-radius: 12px;
    overflow: hidden;
    aspect-ratio: 1;
    transition: all 0.3s ease;
    border: 1px solid rgba(181, 126, 220, 0.2);
}

.package-gallery-item:hover {
    transform: translateY(-5px) scale(1.02);
    border-color: var(--neon-lavender);
    box-shadow: 0 0 30px rgba(181, 126, 220, 0.3);
}

.package-gallery-item img {
    width: 100%;
    height: 100%;
    object-fit: contain !important;
    background-color: rgba(18, 0, 36, 0.5);
    transition: transform 0.4s ease;
}

.package-gallery-item:hover img {
    transform: scale(1.1);
}

.package-gallery-item-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(181, 126, 220, 0.85), rgba(138, 43, 226, 0.85));
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.package-gallery-item:hover .package-gallery-item-overlay {
    opacity: 1;
}

.package-gallery-item-overlay i {
    color: white;
    font-size: 1.5rem;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
}

/* 이미지 상세 모달 */
.package-detail-modal-content {
    background: rgba(18, 0, 36, 0.95);
    backdrop-filter: blur(30px);
    border: 1px solid rgba(181, 126, 220, 0.3);
    border-radius: 24px;
}

.package-detail-img {
    max-height: 75vh;
    max-width: 100%;
    width: auto;
    height: auto;
    object-fit: contain !important;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.package-modal-navigation {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    pointer-events: none;
    z-index: 100;
}

.package-modal-nav-btn {
    pointer-events: all !important;
    background: linear-gradient(135deg, var(--neon-lavender), var(--electric-violet));
    border: none;
    color: white;
    border-radius: 50%;
    width: 55px;
    height: 55px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    opacity: 0.9;
    transition: all 0.3s ease;
    box-shadow: 0 0 20px rgba(181, 126, 220, 0.4);
    cursor: pointer;
}

.package-modal-nav-btn:hover {
    opacity: 1;
    transform: scale(1.1);
    box-shadow: 0 0 30px rgba(181, 126, 220, 0.6);
    color: white;
}

.package-modal-caption p {
    color: #FFFFFF;
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 500;
}

.package-modal-caption small {
    color: rgba(255, 255, 255, 0.85);
    font-size: 1rem;
}

/* Dark Mode - Package Photo Gallery */
body:not(.light-mode) .category-title.stg_card_title {
    color: rgb(139, 92, 246) !important;
    background: #ffffff !important;
    border-color: rgba(139, 92, 246, 0.3) !important;
}

body:not(.light-mode) .category-title.stg_card_title i {
    color: rgb(139, 92, 246) !important;
}

body:not(.light-mode) .package-photo-card {
    background: rgba(30, 20, 40, 0.9);
    border-color: rgba(181, 126, 220, 0.3);
}

body:not(.light-mode) .package-photo-card:hover {
    border-color: rgba(181, 126, 220, 0.6);
    box-shadow: 0 8px 30px rgba(181, 126, 220, 0.3);
}

body:not(.light-mode) .concept-title {
    color: #C8AAFF;
}

body:not(.light-mode) .package-info-section {
    background: rgba(139, 92, 246, 0.08);
    border-top-color: rgba(181, 126, 220, 0.25);
}

body:not(.light-mode) .package-info-item {
    color: rgba(255, 255, 255, 0.8);
}

body:not(.light-mode) .info-label {
    color: #C8AAFF;
}

body:not(.light-mode) .info-value {
    color: rgba(255, 255, 255, 0.9);
}

body:not(.light-mode) .package-price .info-value {
    color: #E0D0FF;
}

body:not(.light-mode) .package-thumbnail-img {
    background-color: rgba(30, 20, 40, 0.9);
}

/* Responsive - Package Photo Gallery */
@media (max-width: 768px) {
    .package-thumbnail-img {
        height: 250px;
    }
    
    .category-title.stg_card_title {
        font-size: 1.3rem !important;
    }
    
    .concept-title {
        font-size: 1rem;
    }
    
    .package-gallery-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        padding: 1rem;
    }
    
    .package-modal-nav-btn {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
    }
    
    .package-modal-navigation {
        padding: 0 10px;
    }
}

/* Service Header */
.service-header {
    background: #ffffff;
    padding: 4rem 2rem;
    /* border, border-radius, box-shadow는 stg_card_sub_format 클래스에서 상속 */
}

.service-title {
    font-family: 'Nanum Gothic', sans-serif;
    font-size: 2.5rem;
    color: rgba(139, 95, 191, 0.8);
    font-weight: 600;
    letter-spacing: 0.02em;
}

.service-subtitle {
    font-size: 1.2rem;
    color: #6c757d;
    line-height: 1.8;
    margin: 0;
    white-space: pre-line;
}

/* Service Info Card - stg_card_format 확장 (좌측 정렬 컨텐츠용) */
.service-info-card {
    text-align: left !important;
    padding: 2rem !important;
    display: block !important;
}

.service-info-card:hover {
    transform: translateY(-3px);
}

/* Light Mode 스타일 */
body.light-mode .service-info-card {
    text-align: left !important;
}

.section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem;
    color: #44237A;
    font-weight: 400;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(181, 126, 220, 0.2);
    position: relative;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 60px;
    height: 2px;
    background: linear-gradient(90deg, var(--neon-lavender), transparent);
    box-shadow: 0 0 10px rgba(181, 126, 220, 0.5);
}

/* Feature List */
.feature-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.feature-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1rem;
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.7;
}

.feature-item i {
    color: var(--neon-lavender);
    margin-right: 0.75rem;
    margin-top: 0.2rem;
    flex-shrink: 0;
    filter: drop-shadow(0 0 5px rgba(181, 126, 220, 0.5));
}

/* Package Table Section */
.package-table-section {
    border-top: 1px solid rgba(181, 126, 220, 0.15);
    padding-top: 1.5rem;
}

.package-table-section:first-child {
    border-top: none;
    padding-top: 0;
}

.package-table-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.3rem;
    color: #44237A !important;
    font-weight: 500;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px dashed rgba(181, 126, 220, 0.3);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.package-table-title::before {
    content: '▸';
    color: #44237A;
}

.package-table-container {
    overflow-x: auto;
}

/* Booking Content */
.booking-content {
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.8;
}

.booking-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.booking-list li {
    position: relative;
    padding-left: 1.5rem;
    margin-bottom: 0.5rem;
    line-height: 1.5;
}

.booking-list li::before {
    content: "•";
    color: #8B5CF6;
    font-weight: bold;
    position: absolute;
    left: 0;
    top: 0;
}

/* Light Mode bullet color */
body.light-mode .booking-list li::before {
    color: #8B5CF6;
}

/* Dark Mode bullet color */
body:not(.light-mode) .booking-list li::before {
    color: #C8AAFF;
    text-shadow: 0 0 10px rgba(181, 126, 220, 0.5);
}

/* booking-list 내 stg_body_text 마진/패딩 조정 */
.booking-list li.stg_body_text {
    margin: 0 0 0.5rem 0 !important;
    padding: 0 0 0 1.5rem !important;
    line-height: 1.5 !important;
}

.guide-paragraph {
    margin-bottom: 1rem;
    color: rgba(255, 255, 255, 0.75);
}

.note-text {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
}

/* Light Mode - Note Text */
body.light-mode .note-text {
    color: rgba(90, 70, 110, 0.7);
}

.account-info {
    background: rgba(181, 126, 220, 0.1);
    border-left: 3px solid var(--neon-lavender);
    padding: 1rem 1.5rem;
    margin-top: 0.75rem;
    border-radius: 0 12px 12px 0;
    box-shadow: 0 0 20px rgba(181, 126, 220, 0.1);
}

.account-info strong {
    color: var(--neon-lavender);
}

/* Example Info Box (예) 부분) */
.example-info {
    background: rgba(181, 126, 220, 0.08);
    border-left: 3px solid rgba(181, 126, 220, 0.6);
    padding: 1rem 1.5rem;
    margin-top: 0.75rem;
    border-radius: 0 12px 12px 0;
    box-shadow: 0 0 15px rgba(181, 126, 220, 0.08);
}

.example-line {
    color: rgba(255, 255, 255, 0.75);
    margin-bottom: 0.5rem;
    line-height: 1.7;
}

.example-line:last-child {
    margin-bottom: 0;
}

/* Light Mode - Example Info */
body.light-mode .example-info {
    background: rgba(139, 92, 246, 0.08);
    border-left-color: rgba(139, 92, 246, 0.6);
    box-shadow: 0 0 15px rgba(139, 92, 246, 0.08);
}

body.light-mode .example-line {
    color: var(--stg-body-color-light);
}

/* Light Mode - Account Info */
body.light-mode .account-info {
    background: rgba(139, 92, 246, 0.1);
    border-left-color: rgba(139, 92, 246, 0.7);
    box-shadow: 0 0 20px rgba(139, 92, 246, 0.1);
}

body.light-mode .account-info strong {
    color: #6B4D8A;
}

/* Refund & Overtime Table Containers */
.refund-table-container,
.overtime-charge-table-container {
    margin-top: 1.5rem;
}

.refund-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.2rem;
    color: #44237A !important;
    font-weight: 400;
    margin: 1.5rem 0 1rem 0;
}

body.light-mode .refund-subtitle {
    color: #44237A !important;
}

/* International Customer Notice */
.international-notice {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(181, 126, 220, 0.2) 100%);
    border: 2px solid rgba(139, 92, 246, 0.4);
    border-radius: 16px;
    padding: 1.25rem 1.5rem;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.15), 
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
    animation: noticeGlow 2s ease-in-out infinite alternate;
}

@keyframes noticeGlow {
    0% {
        box-shadow: 0 4px 20px rgba(139, 92, 246, 0.15), 
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    100% {
        box-shadow: 0 4px 30px rgba(139, 92, 246, 0.25), 
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }
}

.international-notice-icon {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
}

.international-notice-icon i {
    font-size: 1.5rem;
    color: #ffffff;
}

.international-notice-content {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
}

.international-notice-text {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    flex: 1;
    min-width: 200px;
}

.international-contact-btn {
    display: inline-flex;
    align-items: center;
    background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
    color: #ffffff;
    padding: 0.6rem 1.25rem;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    white-space: nowrap;
}

.international-contact-btn:hover {
    background: linear-gradient(135deg, #7C3AED 0%, #9333EA 100%);
    color: #ffffff;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
}

/* Light Mode - International Notice */
body.light-mode .international-notice {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(168, 85, 247, 0.15) 100%);
    border-color: rgba(139, 92, 246, 0.35);
    box-shadow: 0 4px 20px rgba(139, 92, 246, 0.1);
}

body.light-mode .international-notice-text {
    color: #44237A;
}

/* Package Mobile/Desktop View Toggle */
.package-mobile-view {
    display: none;
}

.package-desktop-view {
    display: block;
}

/* Package Mobile Card Styles */
.package-mobile-card {
    background: rgba(181, 126, 220, 0.08);
    border: 1px solid rgba(181, 126, 220, 0.2);
    border-radius: 12px;
    padding: 1rem 1.25rem;
    margin-bottom: 0.75rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.package-mobile-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(181, 126, 220, 0.2);
    border-color: rgba(181, 126, 220, 0.4);
    background: rgba(181, 126, 220, 0.12);
}

.package-mobile-card:last-child {
    margin-bottom: 0;
}

.package-mobile-card-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: calc(var(--stg-body-font-size) * 0.9);
    font-weight: 600;
    color: #44237A;
    margin: 0 0 0.5rem 0;
    padding-bottom: 0.4rem;
    border-bottom: 1px dashed rgba(181, 126, 220, 0.3);
}

.package-mobile-card-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.package-mobile-card-list li {
    position: relative;
    padding-left: 1rem;
    margin-bottom: 0.25rem;
    font-family: var(--stg-body-font-family);
    font-size: calc(var(--stg-body-font-size) * 0.9);
    line-height: 1.5;
    color: var(--stg-body-color-light);
}

.package-mobile-card-list li:last-child {
    margin-bottom: 0;
}

.package-mobile-card-list li::before {
    content: "•";
    color: #8B5CF6;
    font-weight: bold;
    position: absolute;
    left: 0;
    top: 0;
}

/* Dark Mode - Package Mobile Card */
body:not(.light-mode) .package-mobile-card {
    background: rgba(181, 126, 220, 0.1);
    border-color: rgba(181, 126, 220, 0.25);
}

body:not(.light-mode) .package-mobile-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(181, 126, 220, 0.3);
    border-color: rgba(181, 126, 220, 0.5);
    background: rgba(181, 126, 220, 0.18);
}

body:not(.light-mode) .package-mobile-card-title {
    color: var(--neon-lavender);
}

body:not(.light-mode) .package-mobile-card-list li {
    color: rgba(255, 255, 255, 0.8);
}

body:not(.light-mode) .package-mobile-card-list li::before {
    color: #C8AAFF;
    text-shadow: 0 0 10px rgba(181, 126, 220, 0.5);
}

/* Responsive */
@media (max-width: 768px) {
    .service-header {
        padding: 3rem 1.5rem;
    }
    
    .service-title {
        font-size: 2rem;
    }
    
    .service-info-card {
        padding: 1.5rem !important;
    }
    
    .section-title {
        font-size: 1.4rem;
    }
    
    /* Package Mobile View Toggle */
    .package-mobile-view {
        display: block;
    }
    
    .package-desktop-view {
        display: none;
    }
    
    /* International Notice Mobile */
    .international-notice {
        flex-direction: column;
        text-align: center;
        padding: 1.25rem;
        gap: 0.75rem;
    }
    
    .international-notice-content {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .international-notice-text {
        text-align: center;
        min-width: auto;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 패키지 화보 모달 관련 변수
    const packagePhotoModal = document.getElementById('packagePhotoModal');
    const packageDetailModal = document.getElementById('packageImageDetailModal');
    const packageGalleryGrid = document.getElementById('packageGalleryGrid');
    const packageDetailImage = document.getElementById('packageDetailImage');
    const packageModalCaption = document.getElementById('packageModalCaption');
    const packageModalCounter = document.getElementById('packageModalCounter');
    const packagePrevBtn = document.getElementById('packagePrevImage');
    const packageNextBtn = document.getElementById('packageNextImage');
    
    let currentPackageImages = [];
    let currentPackageImageIndex = 0;
    let currentPackageConcept = '';
    
    // 패키지 화보 카드 클릭 시 모달 열기
    if (packagePhotoModal) {
        packagePhotoModal.addEventListener('show.bs.modal', function(event) {
            const trigger = event.relatedTarget;
            const photoCard = trigger.closest('.package-photo-card');
            
            if (!photoCard) return;
            
            const photoId = photoCard.getAttribute('data-photo-id');
            const concept = photoCard.getAttribute('data-concept');
            const category = photoCard.getAttribute('data-category');
            const imagesJson = photoCard.getAttribute('data-images');
            
            currentPackageConcept = concept;
            
            try {
                currentPackageImages = JSON.parse(imagesJson);
            } catch (e) {
                console.error('Failed to parse images:', e);
                currentPackageImages = [];
            }
            
            // 모달 타이틀 설정
            document.getElementById('packagePhotoModalLabel').textContent = concept;
            
            // 갤러리 그리드에 이미지 로드 (lazy loading)
            loadPackageGalleryImages(currentPackageImages, concept);
        });
    }
    
    // 갤러리 이미지 로드 함수
    function loadPackageGalleryImages(imageIds, concept) {
        packageGalleryGrid.innerHTML = '';
        
        imageIds.forEach((imageId, index) => {
            const item = document.createElement('div');
            item.className = 'package-gallery-item';
            item.setAttribute('data-index', index);
            item.innerHTML = `
                <img src="/package-photo-image/${imageId}" 
                     alt="${concept} - ${index + 1}"
                     loading="lazy">
                <div class="package-gallery-item-overlay">
                    <i class="bi bi-zoom-in"></i>
                </div>
            `;
            
            // 개별 이미지 클릭 시 상세 모달 열기
            item.addEventListener('click', function() {
                currentPackageImageIndex = index;
                openPackageDetailModal(index);
            });
            
            packageGalleryGrid.appendChild(item);
        });
    }
    
    // 상세 모달 열기
    function openPackageDetailModal(index) {
        if (currentPackageImages.length === 0) return;
        
        currentPackageImageIndex = index;
        const imageId = currentPackageImages[index];
        
        packageDetailImage.src = `/package-photo-image/${imageId}`;
        packageModalCaption.textContent = currentPackageConcept;
        packageModalCounter.textContent = `${index + 1} / ${currentPackageImages.length}`;
        
        // 네비게이션 버튼 표시/숨김
        packagePrevBtn.style.visibility = index > 0 ? 'visible' : 'hidden';
        packageNextBtn.style.visibility = index < currentPackageImages.length - 1 ? 'visible' : 'hidden';
        
        // 갤러리 모달 닫고 상세 모달 열기
        const galleryModalInstance = bootstrap.Modal.getInstance(packagePhotoModal);
        if (galleryModalInstance) {
            galleryModalInstance.hide();
        }
        
        setTimeout(() => {
            const detailModal = new bootstrap.Modal(packageDetailModal);
            detailModal.show();
        }, 300);
    }
    
    // 이전/다음 네비게이션
    if (packagePrevBtn) {
        packagePrevBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (currentPackageImageIndex > 0) {
                currentPackageImageIndex--;
                updatePackageDetailImage();
            }
        });
    }
    
    if (packageNextBtn) {
        packageNextBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (currentPackageImageIndex < currentPackageImages.length - 1) {
                currentPackageImageIndex++;
                updatePackageDetailImage();
            }
        });
    }
    
    function updatePackageDetailImage() {
        const imageId = currentPackageImages[currentPackageImageIndex];
        packageDetailImage.src = `/package-photo-image/${imageId}`;
        packageModalCounter.textContent = `${currentPackageImageIndex + 1} / ${currentPackageImages.length}`;
        
        packagePrevBtn.style.visibility = currentPackageImageIndex > 0 ? 'visible' : 'hidden';
        packageNextBtn.style.visibility = currentPackageImageIndex < currentPackageImages.length - 1 ? 'visible' : 'hidden';
    }
    
    // 키보드 네비게이션
    document.addEventListener('keydown', function(e) {
        if (packageDetailModal && packageDetailModal.classList.contains('show')) {
            if (e.key === 'ArrowLeft' && currentPackageImageIndex > 0) {
                currentPackageImageIndex--;
                updatePackageDetailImage();
            } else if (e.key === 'ArrowRight' && currentPackageImageIndex < currentPackageImages.length - 1) {
                currentPackageImageIndex++;
                updatePackageDetailImage();
            } else if (e.key === 'Escape') {
                const detailModalInstance = bootstrap.Modal.getInstance(packageDetailModal);
                if (detailModalInstance) {
                    detailModalInstance.hide();
                }
            }
        }
    });
    
    // 상세 모달 닫힐 때 갤러리 모달 다시 열기
    if (packageDetailModal) {
        packageDetailModal.addEventListener('hidden.bs.modal', function() {
            setTimeout(() => {
                const galleryModal = new bootstrap.Modal(packagePhotoModal);
                galleryModal.show();
            }, 100);
        });
    }
});
</script>
{% endblock %}
